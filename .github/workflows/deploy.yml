name: Deploy

on:
  push:
    branches:
      - main
    paths:
      - .github/workflows/deploy.yml
      - README.md
      - acknowledgements.html
      - biblio.js
      - terms.html
      - acknowledgements/**
      - css/**
      - img/**
      - script/**
      - utility/**
env:
  CI: true
     
jobs:
  deploy:
    runs-on: ubuntu-latest
    if: github.repository == 'w3c/aria-common'
    strategy:
      fail-fast: false
      matrix:
        include:
          - repo: w3c/accname
            branch: main
          - repo: w3c/accname
            branch: stable            
          - repo: w3c/aria
            branch: main
          - repo: w3c/aria
            branch: stable
          - repo: w3c/aria-practices
            branch: main
          - repo: w3c/core-aam
            branch: main
          - repo: w3c/core-aam
            branch: stable
          - repo: w3c/css-aam
            branch: main
          - repo: w3c/dpub-aam
            branch: main
          - repo: w3c/dpub-aria
            branch: main
          - repo: w3c/graphics-aam
            branch: main
          - repo: w3c/graphics-aria
            branch: main
          - repo: w3c/math-aam
            branch: main
          - repo: w3c/math-aria
            branch: main
          - repo: w3c/mathml-aam
            branch: main
          - repo: w3c/svg-aam
            branch: main
          - repo: w3c/html-aam
            branch: gh-pages

    steps:
    - uses: actions/checkout@v2

    - uses: actions/checkout@v2
      with:
        repository: ${{ matrix.repo }}
        path: ${{ matrix.repo }}
        ref: ${{ matrix.branch }}
        token: ${{ secrets.GH_TOKEN }}

    - name: Cleanup old files
      run: |
        rm -rf ${{ matrix.repo }}/common/

    - name: Copy files
      run: |
        mkdir ${{ matrix.repo }}/common
        cp -R README.md ${{ matrix.repo }}/common
        cp -R acknowledgements.html ${{ matrix.repo }}/common
        cp -R biblio.js ${{ matrix.repo }}/common
        cp -R terms.html ${{ matrix.repo }}/common
        cp -R acknowledgements ${{ matrix.repo }}/common
        cp -R css ${{ matrix.repo }}/common
        cp -R img ${{ matrix.repo }}/common
        cp -R script ${{ matrix.repo }}/common
        cp -R utility ${{ matrix.repo }}/common

    - name: Commit back
      run: |
        cd ${{ matrix.repo }}
        git config user.name github-actions[bot]
        git config user.email github-actions[bot]@users.noreply.github.com
        git add --all
        git commit -m "chore: sync from w3c/aria-common" -m "Generated by https://github.com/w3c/aria-common/commit/${{ github.sha }}" || true
        git push
